<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/cal-heatmap/dist/cal-heatmap.css">
    <script src="https://unpkg.com/cal-heatmap/dist/plugins/Legend.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/cal-heatmap/dist/plugins/Tooltip.min.js"></script>
    <sript src="./js/main.js"></sript>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Fitness Tracker</title>
</head>

<body>
    <h1 id="plotTitle" class="text-3xl font-bold underline text-center">
        Title
    </h1>
    <div id="cal-heatmap" class="flex justify-center items-center my-4 text-lg"></div>
    <div id="legend-label" class="flex justify-center items-center"></div>
    <script>
        async function updateHeading() {
            const response = await fetch('/api/title');
            const title = await response.json();

            const heading = document.getElementById("plotTitle");

            if (title) {
                heading.innerText = title;
            }
        }

        updateHeading();
    </script>
    <script>

        // 수정사항 : 오늘을 기준으로 해당 연도의 1월부터 12월까지 보여주는 달력으로 바꿈
        // 따라서 시작 날짜를 2022-12-25이 아니라 올해 연도의 1월 1일로 설정하게 해야 함

        // 수정사항 : Sports의 체크박스 값에 따라 색이 바뀌도록 수정

        async function paintCalendar() {
            const response = await fetch('/api/daily-sports');
            const dataSet = await response.json();
    
            // Filter out entries where the 'Sports' checkbox is not true
            const filteredData = dataSet.filter(d => d.sportChecked);
    
            // Create an object to map dates to their sport status for the calendar
            const dataForCalendar = filteredData.reduce((acc, item) => {
                const dateStr = item.date.toISOString().split('T')[0]; // Convert Date to YYYY-MM-DD format
                acc[dateStr] = item.sportChecked ? 1 : 0; // Use 1 for true, 0 for false
                return acc;
            }, {});
    
            const cal = new CalHeatmap();
            cal.paint({
                data: dataForCalendar,
                start: new Date(`${new Date().getFullYear()}-01-01`),
                domain: "month",
                subDomain: "day",
                range: 12,
                cellSize: 15,
                cellPadding: 5,
                cellRadius: 5,
                domainGutter: 10,
                domainLabelFormat: "%B %Y",
                subDomainTitleFormat: {
                    empty: "No data on {date}",
                    filled: "Sports on {date}",
                },
                legend: [1],
                legendColors: {
                    min: "#efefef",
                    max: "steelblue",
                    empty: "white"
                },
                tooltip: true
            });
        }
    
        paintCalendar();
    </script>
</body>

</html>
