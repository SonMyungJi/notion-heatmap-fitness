<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/cal-heatmap/dist/cal-heatmap.css"></link>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/cal-heatmap/dist/plugins/Tooltip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Fitness Tracker</title>
</head>
<body>
    <h1 id="plotTitle" class="text-3xl font-bold underline text-center">
        Title
    </h1>
    <div id="cal-heatmap" class="flex justify-center items-center my-4 text-lg"></div>
    <div id="legend-label" class="flex justify-center items-center"></div>
    <script>
        async function updateHeading() {
            const response = await fetch('/api/title');
            const title = await response.json();
            const heading = document.getElementById("plotTitle");
            if (title) {
                heading.innerText = title;
            }
        }

        updateHeading();

        async function paintCalendar() {
            const response = await fetch('/api/daily-sports');
            const dataSet = await response.json();

            const datesCounts = dataSet.reduce((acc, cur) => {
                const dateKey = new Date(cur.date).getTime() / 1000; // UNIX timestamp
                if (cur.sun) {
                    acc[dateKey] = (acc[dateKey] || 0) + 1;
                }
                return acc;
            }, {});

            const cal = new CalHeatmap();
            cal.paint({
                itemSelector: "#cal-heatmap",
                domain: "month",
                subDomain: "day",
                data: datesCounts,
                start: new Date(new Date().getFullYear(), 0),
                range: 12,
                domainGutter: 10,
                tooltip: true,
                scale: [0, 1, 2, 3, 4, 5],
                scaleColors: ["#FFFFFF", "#E0F2F1", "#B2DFDB", "#80CBC4", "#4DB6AC", "#00897B"],
                onClick: function(date, value) {
                    console.log(`Clicked on ${date} with value ${value}`);
                }
            });
        }

        paintCalendar();
    </script>
</body>
</html>
