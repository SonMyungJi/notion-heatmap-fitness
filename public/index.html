<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/cal-heatmap/dist/cal-heatmap.css">
    <script src="https://unpkg.com/cal-heatmap/dist/plugins/Legend.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/cal-heatmap/dist/plugins/Tooltip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Fitness Tracker</title>
</head>

<body>
    <h1 id="plotTitle" class="text-3xl font-bold underline text-center">
        Title
    </h1>
    <div id="cal-heatmap" class="flex justify-center items-center my-4 text-lg"></div>
    <div id="legend-label" class="flex justify-center items-center"></div>
    <script>
        async function updateHeading() {
            const response = await fetch('/api/title');
            const title = await response.json();

            const heading = document.getElementById("plotTitle");

            if (title) {
                heading.innerText = title;
            }
        }

        updateHeading();
    </script>
    <script>

        // 수정사항 : Sports가 true인 날짜들이 달력에 표시되도록 수정

        async function paintCalendar() {
            const response = await fetch('/api/daily-sports');
            const dataSet = await response.json();

            // Sports가 true인, date의 값만 있는 배열
            const dates = dataSet.filter(d => d.sport).map(d => d.date);

            const today = new Date();
            const startOfYear = `${today.getFullYear()}-01-01`;

            const cal = new CalHeatmap();
            cal.init({
                data: dates, // 수정: dates 배열을 전달하여 색칠할 날짜를 지정
                domain: 'month',
                subDomain: 'day',
                cellSize: 15,
                cellPadding: 4,
                domainGutter: 8,
                range: 12,
                start: new Date(startOfYear),
                legend: [1, 2, 3, 4],
                itemName: ['activity', 'activities'],
                subDomainTextFormat: "%d",
                displayLegend: true,
                legendCellSize: 15,
                legendVerticalPosition: "bottom",
                tooltip: true
            });
        }

        paintCalendar();
    </script>
</body>

</html>
